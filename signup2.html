<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signup | Remote Roofers</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      sendEmailVerification
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDmBLEUz5EWtv1si_UgfKgOiRS8P-wWOnc",
      authDomain: "remoteroofers-51826.firebaseapp.com",
      projectId: "remoteroofers-51826",
      storageBucket: "remoteroofers-51826.firebasestorage.app",
      messagingSenderId: "901240361996",
      appId: "1:901240361996:web:2a209986f74f15618aca29"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ADMIN EMAIL LIST
    const adminEmails = ["admin@remoteroofers.com"];

    window.signupUser = async function () {
      const firstName = firstNameEl.value.trim();
      const lastName = lastNameEl.value.trim();
      const email = emailEl.value.trim();
      const phone = phoneEl.value.trim();
      const password = passwordEl.value;
      const confirmPassword = confirmPasswordEl.value;
      const errorBox = document.getElementById("error");

      errorBox.textContent = "";

      if (!firstName || !lastName || !email || !password) {
        errorBox.textContent = "Please fill all required fields.";
        return;
      }

      if (password !== confirmPassword) {
        errorBox.textContent = "Passwords do not match.";
        return;
      }

      const isAdmin = adminEmails.includes(email);

      if (isAdmin && password.length < 12) {
        errorBox.textContent = "Admin password must be at least 12 characters.";
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await setDoc(doc(db, "users", user.uid), {
          firstName,
          lastName,
          email,
          phone,
          role: isAdmin ? "admin" : "client",
          emailVerified: false,
          createdAt: new Date()
        });

        await sendEmailVerification(user);

        signupSuccess(
          "Account created! Please verify your email before logging in."
        );

      } catch (error) {
        console.error(error);
        errorBox.textContent = error.message;
      }
    };
  </script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-6">Create Account</h1>

    <div class="space-y-4">
      <input id="firstName" placeholder="First Name"
        class="w-full px-4 py-2 border rounded-lg" />
      <input id="lastName" placeholder="Last Name"
        class="w-full px-4 py-2 border rounded-lg" />
      <input id="email" type="email" placeholder="Email"
        class="w-full px-4 py-2 border rounded-lg" />
      <input id="phone" placeholder="Phone (optional)"
        class="w-full px-4 py-2 border rounded-lg" />

      <!-- PASSWORD -->
      <div class="relative">
        <input id="password" type="password" placeholder="Password"
          class="w-full px-4 py-2 border rounded-lg pr-10" />
        <span onclick="togglePassword('password')"
          class="absolute right-3 top-2.5 cursor-pointer">üëÅ</span>
      </div>

      <div class="relative">
        <input id="confirmPassword" type="password" placeholder="Confirm Password"
          class="w-full px-4 py-2 border rounded-lg pr-10" />
        <span onclick="togglePassword('confirmPassword')"
          class="absolute right-3 top-2.5 cursor-pointer">üëÅ</span>
      </div>

      <!-- STRENGTH -->
      <div class="w-full bg-gray-200 rounded h-2">
        <div id="strengthBar" class="h-2 rounded w-0"></div>
      </div>
      <p id="strengthText" class="text-sm"></p>

      <p id="error" class="text-red-600 text-sm"></p>

      <button id="signupBtn" onclick="signupUser()" disabled
        class="w-full bg-blue-600 text-white py-2 rounded-lg opacity-50 cursor-not-allowed">
        Sign Up
      </button>

      <p class="text-center text-sm">
        Already have an account?
        <a href="login.html" class="text-blue-600 font-semibold">Login</a>
      </p>
    </div>
  </div>

  <!-- SUCCESS TOAST -->
  <div id="successToast" class="hidden fixed top-4 right-4">
    <div class="bg-green-100 border-l-4 border-green-600 p-4 rounded shadow">
      <p id="successMessage" class="text-green-800 font-semibold"></p>
    </div>
  </div>

  <!-- UI + VALIDATION -->
  <script>
    const passwordEl = document.getElementById("password");
    const confirmPasswordEl = document.getElementById("confirmPassword");
    const signupBtn = document.getElementById("signupBtn");
    const strengthBar = document.getElementById("strengthBar");
    const strengthText = document.getElementById("strengthText");

    const firstNameEl = document.getElementById("firstName");
    const lastNameEl = document.getElementById("lastName");
    const emailEl = document.getElementById("email");
    const phoneEl = document.getElementById("phone");

    function togglePassword(id) {
      const input = document.getElementById(id);
      input.type = input.type === "password" ? "text" : "password";
    }

    function validatePassword() {
      const password = passwordEl.value;
      const confirm = confirmPasswordEl.value;
      let score = 0;

      if (password.length >= 8) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;
      if (/[^A-Za-z0-9]/.test(password)) score++;

      const levels = [
        ["25%", "bg-red-500", "Weak"],
        ["50%", "bg-yellow-500", "Fair"],
        ["75%", "bg-blue-500", "Good"],
        ["100%", "bg-green-600", "Strong"]
      ];

      if (score > 0) {
        strengthBar.style.width = levels[score - 1][0];
        strengthBar.className = `h-2 rounded ${levels[score - 1][1]}`;
        strengthText.textContent = levels[score - 1][2];
      } else {
        strengthBar.style.width = "0";
        strengthText.textContent = "";
      }

      const valid = score === 4 && password === confirm;
      signupBtn.disabled = !valid;
      signupBtn.classList.toggle("opacity-50", !valid);
      signupBtn.classList.toggle("cursor-not-allowed", !valid);
    }

    passwordEl.addEventListener("input", validatePassword);
    confirmPasswordEl.addEventListener("input", validatePassword);

    function signupSuccess(message) {
      document.getElementById("successMessage").textContent = message;
      document.getElementById("successToast").classList.remove("hidden");
      setTimeout(() => window.location.href = "login.html", 2500);
    }
  </script>

</body>
</html>
