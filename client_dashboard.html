<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Client dashboard for managing roofing service orders and account information">
    <title>Client Dashboard | RoofMetrics Pro</title>
    <link rel="stylesheet" href="dashboard.css">
  
  <script type="module" async src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Froofingor6285back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.12"></script>
  <script type="module" defer src="https://static.rocket.new/rocket-shot.js?v=0.0.2"></script>
  </head>
<body class="bg-background min-h-screen">

    <!-- ================= FIREBASE INIT ================= -->
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDmBLEUz5EWtv1si_UgfKgOiRS8P-wWOnc",
  authDomain: "remoteroofers-51826.firebaseapp.com",
  projectId: "remoteroofers-51826",
  storageBucket: "remoteroofers-51826.appspot.com",
  messagingSenderId: "901240361996",
  appId: "1:901240361996:web:2a209986f74f15618aca29"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>


<!-- Header Section -->
<header class="bg-surface border-b border-border-light shadow-custom-sm sticky top-0 z-dropdown">
    <div class="container-custom">
        <div class="flex items-center justify-between h-16">
            <!-- Logo -->
            <div class="flex items-center gap-3">
                <svg class="w-10 h-10" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 4L4 14V26L20 36L36 26V14L20 4Z" fill="#1E3A5F"/>
                    <path d="M20 12L12 17V27L20 32L28 27V17L20 12Z" fill="#4A90A4"/>
                    <path d="M20 18L16 20.5V25.5L20 28L24 25.5V20.5L20 18Z" fill="#E67E22"/>
                </svg>
                <div>
                    <h1 class="text-xl font-heading font-bold text-primary">RoofMetrics Pro</h1>
                    <p class="text-xs text-text-secondary">Client Dashboard</p>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="flex items-center gap-4">
                <a href="roofing_service_order.html" class="btn btn-primary flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    <span class="hidden md:inline">New Order</span>
                </a>
                
                <button onclick="showAccountMenu()" class="flex items-center gap-2 p-2 hover:bg-background rounded-md transition-colors">
                    <div class="w-8 h-8 bg-secondary rounded-full flex items-center justify-center text-white font-semibold">
                        <span id="user-initials">CL</span>
                    </div>
                    <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="container-custom py-6 lg:py-8">
    <!-- Welcome Section -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
            <div>
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-primary mb-2">
                    Welcome back, <span id="display-client-name">Client</span>!
                </h2>
                <p class="text-text-secondary text-base lg:text-lg">Manage your roofing measurement orders and account information</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="badge bg-success-100 text-success-700 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span>Account Active</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="grid lg:grid-cols-3 gap-6 lg:gap-8">
        <!-- Left Column - Client Information -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Client Profile Card -->
            <section class="card-elevated">
                <div class="flex items-center justify-between border-b border-border-light pb-4 mb-6">
                    <h3 class="text-xl font-heading font-semibold text-primary flex items-center gap-2">
                        <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        My Profile
                    </h3>
                    <button onclick="toggleEditMode()" id="edit-profile-btn" class="btn btn-secondary text-sm flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        Edit
                    </button>
                </div>

                <!-- View Mode -->
                <div id="profile-view-mode">
                    <div class="space-y-4">
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Full Name</p>
                            <p class="text-sm font-medium text-primary" id="view-name">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Email Address</p>
                            <p class="text-sm font-medium text-primary" id="view-email">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Phone Number</p>
                            <p class="text-sm font-medium text-primary" id="view-phone">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Default Property Address</p>
                            <p class="text-sm font-medium text-primary" id="view-address">-</p>
                            <p class="text-sm text-text-secondary" id="view-city-state">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Property Type</p>
                            <p class="text-sm font-medium text-primary capitalize" id="view-property-type">-</p>
                        </div>
                    </div>
                </div>

                <!-- Edit Mode (Initially Hidden) -->
                <form id="profile-edit-mode" class="hidden">
                    <div class="space-y-4">
                        <div>
                            <label for="edit-name" class="label">Full Name <span class="text-error">*</span></label>
                            <input type="text" id="edit-name" class="input w-full" required>
                        </div>
                        <div>
                            <label for="edit-email" class="label">Email Address <span class="text-error">*</span></label>
                            <input type="email" id="edit-email" class="input w-full" required>
                        </div>
                        <div>
                            <label for="edit-phone" class="label">Phone Number <span class="text-error">*</span></label>
                            <input type="tel" id="edit-phone" class="input w-full" required>
                        </div>
                        <div>
                            <label for="edit-address" class="label">Default Property Address</label>
                            <input type="text" id="edit-address" class="input w-full">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label for="edit-city" class="label">City</label>
                                <input type="text" id="edit-city" class="input w-full">
                            </div>
                            <div>
                                <label for="edit-state" class="label">State</label>
                                <select id="edit-state" class="input w-full">
                                    <option value="">Select State</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="TX">Texas</option>
                                    <option value="NY">New York</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="edit-zip" class="label">ZIP Code</label>
                            <input type="text" id="edit-zip" class="input w-full" pattern="[0-9]{5}">
                        </div>
                        <div>
                            <label for="edit-property-type" class="label">Property Type</label>
                            <select id="edit-property-type" class="input w-full">
                                <option value="">Select Type</option>
                                <option value="residential">Residential</option>
                                <option value="commercial">Commercial</option>
                                <option value="industrial">Industrial</option>
                                <option value="multi-family">Multi-Family</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6 pt-6 border-t border-border-light">
                        <button type="submit" class="btn btn-primary flex-1">Save Changes</button>
                        <button type="button" onclick="cancelEditMode()" class="btn btn-outline flex-1">Cancel</button>
                    </div>
                </form>
            </section>

            <!-- Quick Stats -->
            <section class="card-elevated">
                <h3 class="text-lg font-heading font-semibold text-primary mb-4">Account Summary</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-background rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-text-tertiary">Total Orders</p>
                                <p class="text-lg font-bold text-primary" id="total-orders-count">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-background rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-accent/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-text-tertiary">Processing</p>
                                <p class="text-lg font-bold text-accent" id="processing-orders-count">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-background rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-text-tertiary">Completed</p>
                                <p class="text-lg font-bold text-success" id="completed-orders-count">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Right Column - Order History -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Order History Section -->
            <section class="card-elevated">
                <div class="border-b border-border-light pb-4 mb-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div>
                            <h3 class="text-2xl font-heading font-semibold text-primary flex items-center gap-2">
                                <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                </svg>
                                Order History
                            </h3>
                            <p class="text-sm text-text-secondary mt-1">Track and manage your roofing measurement orders</p>
                        </div>
                        <a href="roofing_service_order.html" class="btn btn-primary flex items-center gap-2 whitespace-nowrap">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Place New Order
                        </a>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="mb-6">
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="md:col-span-2">
                            <label for="search-orders" class="label">Search Orders</label>
                            <div class="relative">
                                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                                <input 
                                    type="text" 
                                    id="search-orders" 
                                    class="input w-full pl-10" 
                                    placeholder="Search by order reference or address..."
                                    oninput="filterOrders()"
                                >
                            </div>
                        </div>
                        
                        <div>
                            <label for="status-filter" class="label">Filter by Status</label>
                            <select id="status-filter" class="input w-full" onchange="filterOrders()">
                                <option value="all">All Orders</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                                <option value="delivered">Delivered</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Orders List -->
                <div id="orders-container" class="space-y-4">
                    <!-- Orders will be dynamically inserted here -->
                </div>

                <!-- Empty State -->
                <div id="empty-orders-state" class="hidden text-center py-12">
                    <svg class="w-24 h-24 mx-auto text-text-tertiary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <h3 class="text-xl font-heading font-semibold text-primary mb-2">No Orders Found</h3>
                    <p class="text-text-secondary mb-6">You haven't placed any orders yet or no orders match your search.</p>
                    <a href="roofing_service_order.html" class="btn btn-primary inline-flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Place Your First Order
                    </a>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="bg-surface border-t border-border-light mt-12">
    <div class="container-custom py-8">
        <div class="grid md:grid-cols-3 gap-8 mb-8">
            <div>
                <h4 class="font-heading font-semibold text-primary mb-3">RoofMetrics Pro</h4>
                <p class="text-sm text-text-secondary">Professional roofing measurement services for property owners, contractors, and real estate professionals.</p>
            </div>
            <div>
                <h4 class="font-heading font-semibold text-primary mb-3">Quick Links</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="roofing_service_order.html" class="text-text-secondary hover:text-secondary transition-colors">New Order</a></li>
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Services</a></li>
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Pricing</a></li>
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Contact</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-heading font-semibold text-primary mb-3">Support</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Help Center</a></li>
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Terms of Service</a></li>
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Privacy Policy</a></li>
                    <li><a href="javascript:void(0)" class="text-text-secondary hover:text-secondary transition-colors">Refund Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="pt-6 border-t border-border-light text-center text-sm text-text-secondary">
            <p>Â© 2026 RoofMetrics Pro. All Rights Reserved.</p>
        </div>
    </div>
</footer>

<!-- JavaScript for Dashboard Functionality -->
<script>
// ============================================
// CLIENT PROFILE MANAGEMENT
// ============================================

// Load client profile from localStorage
function loadClientProfile() {
    const profile = localStorage.getItem('clientProfile');
    if (profile) {
        const data = JSON.parse(profile);
        
        // Update display fields
        document.getElementById('view-name').textContent = data.name || '-';
        document.getElementById('view-email').textContent = data.email || '-';
        document.getElementById('view-phone').textContent = data.phone || '-';
        document.getElementById('view-address').textContent = data.address || '-';
        document.getElementById('view-city-state').textContent = 
            data.city && data.state ? `${data.city}, ${data.state} ${data.zip || ''}` : '-';
        document.getElementById('view-property-type').textContent = data.propertyType || '-';
        
        // Update welcome message
        document.getElementById('display-client-name').textContent = data.name ? data.name.split(' ')[0] : 'Client';
        
        // Update user initials
        if (data.name) {
            const names = data.name.split(' ');
            const initials = names.length > 1 
                ? names[0][0] + names[names.length - 1][0]
                : names[0][0] + (names[0][1] || '');
            document.getElementById('user-initials').textContent = initials.toUpperCase();
        }
    } else {
        // Set default profile if none exists
        const defaultProfile = {
            name: 'Client User',
            email: 'client@example.com',
            phone: '(555) 123-4567',
            address: '',
            city: '',
            state: '',
            zip: '',
            propertyType: ''
        };
        localStorage.setItem('clientProfile', JSON.stringify(defaultProfile));
        loadClientProfile();
    }
}

// Toggle edit mode
function toggleEditMode() {
    const viewMode = document.getElementById('profile-view-mode');
    const editMode = document.getElementById('profile-edit-mode');
    const editBtn = document.getElementById('edit-profile-btn');
    
    // Hide view mode, show edit mode
    viewMode.classList.add('hidden');
    editMode.classList.remove('hidden');
    
    // Load current values into edit form
    const profile = JSON.parse(localStorage.getItem('clientProfile') || '{}');
    document.getElementById('edit-name').value = profile.name || '';
    document.getElementById('edit-email').value = profile.email || '';
    document.getElementById('edit-phone').value = profile.phone || '';
    document.getElementById('edit-address').value = profile.address || '';
    document.getElementById('edit-city').value = profile.city || '';
    document.getElementById('edit-state').value = profile.state || '';
    document.getElementById('edit-zip').value = profile.zip || '';
    document.getElementById('edit-property-type').value = profile.propertyType || '';
}

// Cancel edit mode
function cancelEditMode() {
    const viewMode = document.getElementById('profile-view-mode');
    const editMode = document.getElementById('profile-edit-mode');
    
    editMode.classList.add('hidden');
    viewMode.classList.remove('hidden');
}

// Save profile changes
document.getElementById('profile-edit-mode').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const profileData = {
        name: document.getElementById('edit-name').value,
        email: document.getElementById('edit-email').value,
        phone: document.getElementById('edit-phone').value,
        address: document.getElementById('edit-address').value,
        city: document.getElementById('edit-city').value,
        state: document.getElementById('edit-state').value,
        zip: document.getElementById('edit-zip').value,
        propertyType: document.getElementById('edit-property-type').value
    };
    
    localStorage.setItem('clientProfile', JSON.stringify(profileData));
    
    // Reload profile display
    loadClientProfile();
    
    // Switch back to view mode
    cancelEditMode();
    
    // Show success message
    alert('Profile updated successfully!');
});

// ============================================
// ORDER HISTORY MANAGEMENT
// ============================================

// Get orders from localStorage
function getOrderHistory() {
    const orders = localStorage.getItem('roofingOrders');
    return orders ? JSON.parse(orders) : [];
}

// Format currency
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
    }).format(amount);
}

// Load and display order history
function loadOrderHistory() {
    const orders = getOrderHistory();
    const container = document.getElementById('orders-container');
    const emptyState = document.getElementById('empty-orders-state');
    
    if (orders.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
        updateOrderStats(orders);
        return;
    }
    
    emptyState.classList.add('hidden');
    container.innerHTML = orders.map(order => createOrderCard(order)).join('');
    updateOrderStats(orders);
}

// Update order statistics
function updateOrderStats(orders) {
    const totalOrders = orders.length;
    const processingOrders = orders.filter(o => o.status === 'processing').length;
    const completedOrders = orders.filter(o => o.status === 'completed' || o.status === 'delivered').length;
    
    document.getElementById('total-orders-count').textContent = totalOrders;
    document.getElementById('processing-orders-count').textContent = processingOrders;
    document.getElementById('completed-orders-count').textContent = completedOrders;
}

// Create order card HTML
function createOrderCard(order) {
    const orderDate = new Date(order.orderDate).toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
    
    const deliveryDate = new Date(order.estimatedDelivery).toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
    
    const statusColors = {
        processing: 'bg-accent-100 text-accent-700',
        completed: 'bg-success-100 text-success-700',
        delivered: 'bg-primary-100 text-primary-700'
    };
    
    const statusIcons = {
        processing: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
        completed: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>`,
        delivered: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`
    };
    
    return `
        <div class="card border border-border-light hover:border-secondary hover:shadow-custom transition-all duration-base">
            <div class="flex flex-col lg:flex-row gap-4">
                <!-- Order Info -->
                <div class="flex-1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-heading font-semibold text-primary mb-1">Order #${order.orderReference}</h4>
                            <p class="text-xs text-text-tertiary">${orderDate}</p>
                        </div>
                        <span class="badge ${statusColors[order.status]} flex items-center gap-1 text-xs">
                            ${statusIcons[order.status]}
                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                        </span>
                    </div>
                    
                    <div class="grid sm:grid-cols-2 gap-3 text-sm">
                        <div>
                            <p class="text-xs text-text-tertiary mb-1">Property</p>
                            <p class="font-medium text-primary">${order.formData.propertyAddress}</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary mb-1">Report Type</p>
                            <p class="font-medium text-primary capitalize">${order.reportType} - ${order.serviceTier}</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary mb-1">Total Price</p>
                            <p class="font-bold text-secondary">${formatCurrency(order.totalPrice)}</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary mb-1">Est. Delivery</p>
                            <p class="font-medium text-primary">${deliveryDate}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex lg:flex-col gap-2 lg:w-40">
                    <a href="roofing_service_order.html" onclick="reorderService('${order.id}')" class="btn btn-secondary btn-sm w-full flex items-center justify-center gap-1 text-xs">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Reorder
                    </a>
                    <button onclick="viewOrderDetails('${order.id}')" class="btn btn-outline btn-sm w-full flex items-center justify-center gap-1 text-xs">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        Details
                    </button>
                    ${order.status === 'delivered' ? `
                    <button onclick="downloadReport('${order.id}')" class="btn btn-primary btn-sm w-full flex items-center justify-center gap-1 text-xs">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Download
                    </button>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
}

// Filter orders
function filterOrders() {
    const searchQuery = document.getElementById('search-orders').value.toLowerCase();
    const statusFilter = document.getElementById('status-filter').value;
    const orders = getOrderHistory();
    
    const filteredOrders = orders.filter(order => {
        if (statusFilter !== 'all' && order.status !== statusFilter) {
            return false;
        }
        
        if (searchQuery) {
            const searchableText = `
                ${order.orderReference}
                ${order.formData.propertyAddress}
                ${order.formData.city}
            `.toLowerCase();
            
            if (!searchableText.includes(searchQuery)) {
                return false;
            }
        }
        
        return true;
    });
    
    const container = document.getElementById('orders-container');
    const emptyState = document.getElementById('empty-orders-state');
    
    if (filteredOrders.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
    } else {
        emptyState.classList.add('hidden');
        container.innerHTML = filteredOrders.map(order => createOrderCard(order)).join('');
    }
}

// Reorder service - store order ID and redirect
function reorderService(orderId) {
    localStorage.setItem('reorderOrderId', orderId);
}

// View order details
function viewOrderDetails(orderId) {
    const orders = getOrderHistory();
    const order = orders.find(o => o.id === orderId);
    
    if (!order) {
        alert('Order not found');
        return;
    }
    
    // Create modal with order details
    const modalHTML = `
        <div id="order-details-modal" class="fixed inset-0 bg-black/50 z-modal flex items-center justify-center p-4" onclick="closeOrderDetailsModal(event)">
            <div class="bg-surface rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="sticky top-0 bg-surface border-b border-border-light p-6 flex items-center justify-between">
                    <h3 class="text-2xl font-heading font-bold text-primary">Order Details</h3>
                    <button onclick="closeOrderDetailsModal()" class="p-2 hover:bg-background rounded-md transition-colors">
                        <svg class="w-6 h-6 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="p-6 space-y-6">
                    <!-- Order Reference -->
                    <div class="bg-gradient-to-r from-primary to-secondary text-white p-4 rounded-lg text-center">
                        <p class="text-sm opacity-90 mb-1">Order Reference</p>
                        <p class="text-2xl font-heading font-bold">#${order.orderReference}</p>
                    </div>
                    
                    <!-- Order Info -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Order Date</p>
                            <p class="font-medium text-primary">${new Date(order.orderDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>
                        <div>
                            <p class="text-xs text-text-tertiary uppercase tracking-wide mb-1">Status</p>
                            <p class="font-medium text-primary capitalize">${order.status}</p>
                        </div>
                    </div>
                    
                    <!-- Property Details -->
                    <div class="border-t border-border-light pt-4">
                        <h4 class="font-heading font-semibold text-primary mb-3">Property Information</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="text-text-tertiary">Address:</span> <span class="font-medium">${order.formData.propertyAddress}</span></p>
                            <p><span class="text-text-tertiary">City:</span> <span class="font-medium">${order.formData.city}, ${order.formData.state} ${order.formData.zip}</span></p>
                            <p><span class="text-text-tertiary">Property Type:</span> <span class="font-medium capitalize">${order.formData.propertyType}</span></p>
                        </div>
                    </div>
                    
                    <!-- Service Details -->
                    <div class="border-t border-border-light pt-4">
                        <h4 class="font-heading font-semibold text-primary mb-3">Service Details</h4>
                        <div class="bg-background rounded-lg p-4 space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-text-tertiary">Report Type:</span>
                                <span class="font-medium capitalize">${order.reportType}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-tertiary">Service Tier:</span>
                                <span class="font-medium capitalize">${order.serviceTier}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-tertiary">Estimated Delivery:</span>
                                <span class="font-medium">${new Date(order.estimatedDelivery).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                            </div>
                            <div class="flex justify-between pt-2 border-t border-border-light">
                                <span class="font-semibold">Total Price:</span>
                                <span class="font-bold text-secondary">${formatCurrency(order.totalPrice)}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${order.formData.notes ? `
                    <div class="border-t border-border-light pt-4">
                        <h4 class="font-heading font-semibold text-primary mb-2">Additional Notes</h4>
                        <p class="text-sm text-text-secondary">${order.formData.notes}</p>
                    </div>
                    ` : ''}
                </div>
                
                <div class="sticky bottom-0 bg-surface border-t border-border-light p-6 flex gap-3">
                    <a href="roofing_service_order.html" onclick="reorderService('${order.id}')" class="btn btn-primary flex-1">Reorder Service</a>
                    <button onclick="closeOrderDetailsModal()" class="btn btn-outline flex-1">Close</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

// Close order details modal
function closeOrderDetailsModal(event) {
    if (!event || event.target === event.currentTarget) {
        const modal = document.getElementById('order-details-modal');
        if (modal) {
            modal.remove();
        }
    }
}

// Download report (placeholder)
function downloadReport(orderId) {
    alert('Report download functionality would be implemented with actual file storage in production.');
}

// Show account menu (placeholder)
function showAccountMenu() {
    alert('Account menu functionality (logout, settings, etc.) would be implemented here.');
}

// Initialize dashboard on page load
document.addEventListener('DOMContentLoaded', function() {
    loadClientProfile();
    loadOrderHistory();
});
</script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>
