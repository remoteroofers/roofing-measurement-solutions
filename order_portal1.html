<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Order - Remote Roofers</title>

<script src="https://www.paypal.com/sdk/js?client-id=ARiAdLTougjptHbODwbDVmc3ehO6osM9KmmGZLJaVHoSOXCOsjo56lVHx8hi78_HdZq5zkjE4DQSgOLQ&currency=USD"></script>

  <style>
    /* üîí CSS UNCHANGED */




        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
        }

        .btn-back {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-back:hover {
            background: white;
            color: #2a5298;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .order-form {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .form-title {
            color: #333;
            font-size: 28px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2a5298;
        }

        .form-group small {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .order-summary {
            background: #f5f7fa;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .order-summary h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            color: #666;
        }

        .[summary-row.total](http://summary-row.total) {
            border-top: 2px solid #ddd;
            margin-top: 10px;
            padding-top: 15px;
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }

        .total-amount {
            color: #2a5298;
            font-size: 24px;
        }

        .payment-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .payment-section h3 {
            color: #333;
            margin-bottom: 20px;
        }

        #paypal-button-container {
            max-width: 400px;
        }

        .hidden {
            display: none;
        }
 
  </style>
</head>

<body>
<div class="header">
  <h1>üè† Create New Order</h1>
  <a href="client_portal1.html" class="btn-back">‚Üê Back to Portal</a>
</div>

<div class="container">
<div class="order-form">
<h2 class="form-title">Order Details</h2>

<form>
  <div class="form-group">
    <label>Property Address *</label>
    <input id="propertyAddress" required />
  </div>

  <div class="form-group">
    <label>Report Type *</label>
    <select id="reportType" onchange="updatePricing()" required>
      <option value="">Select</option>
      <option>Aerial Square Roof Report</option>
      <option>Residential Roof Report</option>
      <option>Commercial Roof Report</option>
    </select>
  </div>

  <div class="form-group">
    <label>Service Tier *</label>
    <select id="serviceTier" onchange="updatePricing()" required>
      <option value="">Select</option>
      <option>Standard - Regular Processing 8 hrs or Less</option>
      <option>Express - Faster Turnaround 6 hrs or less </option>
      <option>Rush - Priority Processing 2-3 hrs </option>
    </select>
  </div>

  <div>
    <h3>Order Summary</h3>
    <p>Property Address: <span id="propertyAddress">-</span></p>
    <p>Report: <span id="selectedReport">-</span></p>
    <p>Tier: <span id="selectedTier">-</span></p>
    <p><strong>Total: <span id="totalPrice">$0</span></strong></p>
  </div>

  <div id="paymentSection" class="payment-section hidden">
    <h3>Payment</h3>
    <div id="paypal-button-container"></div>
  </div>
</form>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, doc, getDoc }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDmBLEUz5EWtv1si_UgfKgOiRS8P-wWOnc",
  authDomain: "remoteroofers-51826.firebaseapp.com",
  projectId: "remoteroofers-51826"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const userId = sessionStorage.getItem("userId");
if (!userId) location.href = "login.html";

const pricing = {
  "Aerial Square Roof Report": { Standard:10, Express:20, Rush:30 },
  "Residential Roof Report": { Standard:17, Express:25, Rush:30 },
  "Commercial Roof Report": { Standard:30, Express:35, Rush:45 }
};

let currentPrice = 0;
let paypalRendered = false;

window.updatePricing = function () {
  const report = reportType.value;
  const tier = serviceTier.value;

  if (!report || !tier) return;

  currentPrice = pricing[report][tier];
  selectedReport.textContent = report;
  selectedTier.textContent = tier;
  totalPrice.textContent = `$${currentPrice}`;

  paymentSection.classList.remove("hidden");
  paypalRendered = false;
  renderPayPal();
};

function renderPayPal() {
  if (paypalRendered) return;
  paypalRendered = true;

  paypal.Buttons({
    createOrder: (_, actions) =>
      actions.order.create({
        purchase_units: [{ amount: { value: currentPrice.toFixed(2) } }]
      }),
    onApprove: async (_, actions) => {
      const order = await actions.order.capture();
      await saveOrder(order.id);
    }
  }).render("#paypal-button-container");
}

async function saveOrder(paypalId) {
  const userSnap = await getDoc(doc(db, "users", userId));
  const user = userSnap.data();

  await addDoc(collection(db, "orders"), {
    userId,
    name: user.name,
    email: user.email,
    address: propertyAddress.value,
    reportType: reportType.value,
    serviceTier: serviceTier.value,
    amount: currentPrice,
    paypalId,
    createdAt: new Date().toISOString()
  });

  alert("Order placed successfully!");
  location.href = "client_portal1.html";
}
</script>
</body>
</html>
